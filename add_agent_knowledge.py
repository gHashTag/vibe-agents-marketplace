#!/usr/bin/env python3
"""
–î–æ–±–∞–≤–ª—è–µ—Ç —Å–µ–∫—Ü–∏—é "–ó–Ω–∞–Ω–∏–µ –î—Ä—É–≥–∏—Ö –ê–≥–µ–Ω—Ç–æ–≤" –≤–æ –≤—Å–µ —Ñ–∞–π–ª—ã –∞–≥–µ–Ω—Ç–æ–≤
"""

import os
import re

AGENTS_INFO = {
    'vibe-spec.md': {
        'title': 'üìã',
        'description': '—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏',
        'knows': [
            'vibe-tasker (‚úÖ) - –ø–æ–ª—É—á–∞–µ—Ç –º–æ–π –ø–ª–∞–Ω –¥–ª—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏',
            'vibe-coder (üíª) - —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ –º–æ–∏–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º',
            'vibe-tester (üß™) - —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–∏—Ö —Å—Ö–µ–º',
            'vibe-typescript (üìò) - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–∏–ø—ã –∏–∑ JSON Schema',
            'vibe-devops (üöÄ) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –¥–µ–ø–ª–æ—è'
        ],
        'from': [
            'vibe-lead (üëë) - –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç –º–µ–Ω—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ',
            'vibe-queen (üêù) - –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é'
        ]
    },
    'vibe-tasker.md': {
        'title': '‚úÖ',
        'description': '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ',
        'knows': [
            'vibe-spec (üìã) - –ø–æ–ª—É—á–∞—é –æ—Ç –Ω–µ–≥–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é',
            'vibe-coder (üíª) - –ø–µ—Ä–µ–¥–∞—é –µ–º—É –ø–ª–∞–Ω –∑–∞–¥–∞—á –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏',
            'vibe-tester (üß™) - –ø–ª–∞–Ω–∏—Ä—É—é —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏',
            'vibe-lead (üëë) - –æ—Ç—á–∏—Ç—ã–≤–∞—é—Å—å –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ',
            'vibe-critic (üé≠) - –ø–ª–∞–Ω–∏—Ä—É—é —ç—Ç–∞–ø—ã –∫–æ–¥-—Ä–µ–≤—å—é'
        ],
        'from': [
            'vibe-lead (üëë) - –ø–æ–ª—É—á–∞—é –æ—Ç –Ω–µ–≥–æ –æ–±—â—É—é –∑–∞–¥–∞—á—É',
            'vibe-spec (üìã) - –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏'
        ]
    },
    'vibe-coder.md': {
        'title': 'üíª',
        'description': '—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞',
        'knows': [
            'vibe-spec (üìã) - –ø–æ–ª—É—á–∞—é –æ—Ç –Ω–µ–≥–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ',
            'vibe-tasker (‚úÖ) - —Å–ª–µ–¥—É—é –ø–ª–∞–Ω—É –∑–∞–¥–∞—á –æ—Ç –Ω–µ–≥–æ',
            'vibe-tester (üß™) - –ø–∏—à—É –∫–æ–¥ –¥–ª—è –µ–≥–æ —Ç–µ—Å—Ç–æ–≤ (TDD)',
            'vibe-typescript (üìò) - –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É—é—Å—å –ø–æ —Ç–∏–ø–∞–º',
            'vibe-security (üîê) - –∏—Å–ø—Ä–∞–≤–ª—è—é –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏',
            'vibe-critic (üé≠) - –ø—Ä–∏–º–µ–Ω—è—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–≤—å—é'
        ],
        'from': [
            'vibe-tasker (‚úÖ) - –ø–æ–ª—É—á–∞—é –æ—Ç –Ω–µ–≥–æ –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏',
            'vibe-lead (üëë) - –º–æ–≥—É –ø–æ–ª—É—á–∏—Ç—å –ø—Ä—è–º—É—é –∑–∞–¥–∞—á—É'
        ]
    },
    'vibe-critic.md': {
        'title': 'üé≠',
        'description': '–∫–æ–¥-—Ä–µ–≤—å—é',
        'knows': [
            'vibe-coder (üíª) - –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –µ–≥–æ –∫–æ–¥',
            'vibe-tester (üß™) - –ø—Ä–æ–≤–µ—Ä—è—é –∫–∞—á–µ—Å—Ç–≤–æ –µ–≥–æ —Ç–µ—Å—Ç–æ–≤',
            'vibe-security (üîê) - —Å–æ–≤–º–µ—Å—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
            'vibe-typescript (üìò) - –ø—Ä–æ–≤–µ—Ä—è—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤',
            'vibe-spec (üìã) - —Å–≤–µ—Ä—è—é—Å—å —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π'
        ],
        'from': [
            'vibe-lead (üëë) - –ø–æ–ª—É—á–∞—é –∑–∞–¥–∞—á–∏ –Ω–∞ —Ä–µ–≤—å—é',
            'vibe-tasker (‚úÖ) - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –º–æ–∏ —ç—Ç–∞–ø—ã –ø—Ä–æ–≤–µ—Ä–∫–∏',
            'vibe-coder (üíª) - –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–µ–≤—å—é —Å–≤–æ–µ–≥–æ –∫–æ–¥–∞'
        ]
    },
    'vibe-typescript.md': {
        'title': 'üìò',
        'description': '—Ç–∏–ø–∏–∑–∞—Ü–∏—è',
        'knows': [
            'vibe-spec (üìã) - –≥–µ–Ω–µ—Ä–∏—Ä—É—é —Ç–∏–ø—ã –∏–∑ –µ–≥–æ JSON Schema',
            'vibe-coder (üíª) - —Å–æ–∑–¥–∞—é —Ç–∏–ø—ã –¥–ª—è –µ–≥–æ –∫–æ–¥–∞',
            'vibe-tester (üß™) - —Ç–∏–ø–∏–∑–∏—Ä—É—é –µ–≥–æ —Ç–µ—Å—Ç—ã',
            'vibe-sentry (üì°) - –¥–æ–±–∞–≤–ª—è—é —Ç–∏–ø—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞'
        ],
        'from': [
            'vibe-coder (üíª) - –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤',
            'vibe-spec (üìã) - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏',
            'vibe-tester (üíª) - –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤'
        ]
    },
    'vibe-tester.md': {
        'title': 'üß™',
        'description': '—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
        'knows': [
            'vibe-spec (üìã) - —Å–æ–∑–¥–∞—é —Ç–µ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ —Å—Ö–µ–º',
            'vibe-coder (üíª) - —Ç–µ—Å—Ç–∏—Ä—É—é –µ–≥–æ –∫–æ–¥',
            'vibe-security (üîê) - —Å–æ–∑–¥–∞—é security —Ç–µ—Å—Ç—ã',
            'vibe-critic (üé≠) - –ø–æ–ª—É—á–∞—é feedback –ø–æ —Ç–µ—Å—Ç–∞–º',
            'vibe-devops (üöÄ) - –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é —Ç–µ—Å—Ç—ã –≤ –ø–∞–π–ø–ª–∞–π–Ω'
        ],
        'from': [
            'vibe-lead (üëë) - –ø–æ–ª—É—á–∞—é –∑–∞–¥–∞—á–∏ –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
            'vibe-tasker (‚úÖ) - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –º–æ–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏',
            'vibe-coder (üíª) - —Ç–µ—Å—Ç–∏—Ä—É—é –µ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é'
        ]
    },
    'vibe-security.md': {
        'title': 'üîê',
        'description': '–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
        'knows': [
            'vibe-coder (üíª) - –ø—Ä–æ–≤–µ—Ä—è—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –µ–≥–æ –∫–æ–¥–∞',
            'vibe-critic (üé≠) - —Å–æ–≤–º–µ—Å—Ç–Ω–æ –ø—Ä–æ–≤–æ–¥–∏–º —Ä–µ–≤—å—é',
            'vibe-devops (üöÄ) - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é security –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ',
            'vibe-sentry (üì°) - –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é security –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥'
        ],
        'from': [
            'vibe-lead (üëë) - –ø–æ–ª—É—á–∞—é –∑–∞–¥–∞—á–∏ –Ω–∞ –∞—É–¥–∏—Ç',
            'vibe-coder (üíª) - –∏—Å–ø—Ä–∞–≤–ª—è—é –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏'
        ]
    },
    'vibe-devops.md': {
        'title': 'üöÄ',
        'description': '–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞',
        'knows': [
            'vibe-coder (üíª) - –¥–µ–ø–ª–æ—é –µ–≥–æ –∫–æ–¥',
            'vibe-tester (üß™) - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É',
            'vibe-security (üîê) - –ø—Ä–∏–º–µ–Ω—è—é security –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏',
            'vibe-sentry (üì°) - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥',
            'vibe-spec (üìã) - —Å–ª–µ–¥—É—é –µ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º'
        ],
        'from': [
            'vibe-lead (üëë) - –ø–æ–ª—É—á–∞—é –∑–∞–¥–∞—á–∏ –Ω–∞ –¥–µ–ø–ª–æ–π',
            'vibe-coder (üíª) - –¥–µ–ø–ª–æ—é –µ–≥–æ –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ'
        ]
    }
}

def add_knowledge_section(file_path, agent_name, agent_info):
    """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–µ–∫—Ü–∏—é –∑–Ω–∞–Ω–∏—è –≤ —Ñ–∞–π–ª –∞–≥–µ–Ω—Ç–∞"""
    
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–µ–∫—Ü–∏—è –∑–Ω–∞–Ω–∏—è
    if '### üÜî –ó–Ω–∞–Ω–∏–µ –î—Ä—É–≥–∏—Ö –ê–≥–µ–Ω—Ç–æ–≤' in content:
        print(f"‚ö†Ô∏è {file_path}: —Å–µ–∫—Ü–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        return False
    
    # –ù–∞—Ö–æ–¥–∏–º –º–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ (–ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è)
    pattern = r'(## [^#\n]+[^#]\n)'
    match = re.search(pattern, content)
    
    if not match:
        print(f"‚ùå {file_path}: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –º–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏")
        return False
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–µ–∫—Ü–∏—é –∑–Ω–∞–Ω–∏—è
    knows_list = '\n'.join([f'- `{name}`' for name in agent_info['knows']])
    from_list = '\n'.join([f'- `{name}`' for name in agent_info['from']])
    
    knowledge_section = f"""
### üÜî –ó–Ω–∞–Ω–∏–µ –î—Ä—É–≥–∏—Ö –ê–≥–µ–Ω—Ç–æ–≤

**–ó–Ω–∞–µ—Ç –∏ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –°:**
{knows_list}

**–ü–æ–ª—É—á–∞–µ—Ç –ó–∞–¥–∞—á–∏ –û—Ç:**
{from_list}

**–ü—Ä–∏–º–µ—Ä –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**
```typescript
// –ó–∞–ø—É—Å–∫ —Å resume –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
Task({{
  subagent_type: '{agent_name}',
  description: '{agent_info['description']} –∑–∞–¥–∞—á–∞',
  prompt: '–î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏...',
  resume: 'previous-agent-id'  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
}});

// –ü–æ–ª—É—á–µ–Ω–∏–µ agentId –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
const agentId = await Task({{
  subagent_type: '{agent_name}',
  description: '–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É'
}});
```
"""
    
    # –í—Å—Ç–∞–≤–ª—è–µ–º —Å–µ–∫—Ü–∏—é
    insert_pos = match.end()
    new_content = content[:insert_pos] + knowledge_section + content[insert_pos:]
    
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(new_content)
    
    print(f"‚úÖ {file_path}: –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –∑–Ω–∞–Ω–∏—è")
    return True

def main():
    agents_dir = '.claude/agents/'
    updated_count = 0
    
    for filename, info in AGENTS_INFO.items():
        file_path = os.path.join(agents_dir, filename)
        if os.path.exists(file_path):
            agent_name = filename.replace('.md', '')
            if add_knowledge_section(file_path, agent_name, info):
                updated_count += 1
        else:
            print(f"‚ö†Ô∏è –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
    
    print(f"\nüéâ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∞–≥–µ–Ω—Ç–æ–≤: {updated_count}/{len(AGENTS_INFO)}")

if __name__ == '__main__':
    main()
